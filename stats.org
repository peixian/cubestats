#+BEGIN_SRC ipython :session :exports both
  import pandas as pd
  import numpy as np
  import json
#+END_SRC

#+RESULTS:

Load mtgjson into the `cards` variable

#+BEGIN_SRC ipython :session :results output :exports both
  with open('./allcards.json') as infile:
      cards = json.load(infile)

  print(cards['Air Elemental'])
  print(cards['Ætherling'])
  print(cards['Far'])
#+END_SRC

#+RESULTS:
: {'manaCost': '{3}{U}{U}', 'name': 'Air Elemental', 'text': 'Flying', 'type': 'Creature — Elemental', 'cmc': 5, 'toughness': '4', 'imageName': 'air elemental', 'types': ['Creature'], 'colorIdentity': ['U'], 'subtypes': ['Elemental'], 'power': '4', 'colors': ['Blue'], 'layout': 'normal'}
: {'manaCost': '{4}{U}{U}', 'name': 'Ætherling', 'text': "{U}: Exile Ætherling. Return it to the battlefield under its owner's control at the beginning of the next end step.\n{U}: Ætherling can't be blocked this turn.\n{1}: Ætherling gets +1/-1 until end of turn.\n{1}: Ætherling gets -1/+1 until end of turn.", 'type': 'Creature — Shapeshifter', 'cmc': 6, 'toughness': '5', 'imageName': 'ætherling', 'types': ['Creature'], 'colorIdentity': ['U'], 'subtypes': ['Shapeshifter'], 'power': '4', 'colors': ['Blue'], 'layout': 'normal'}
: {'manaCost': '{1}{U}', 'name': 'Far', 'text': "Return target creature to its owner's hand.\nFuse (You may cast one or both halves of this card from your hand.)", 'colorIdentity': ['B', 'U'], 'layout': 'split', 'cmc': 2, 'type': 'Instant', 'colors': ['Blue'], 'imageName': 'far', 'types': ['Instant'], 'names': ['Far', 'Away']}

Google sheets api:

#+BEGIN_SRC ipython :session :results output :exports both
  file_id = '1YHYoEoFFiPwH4LG4_34-EIghaphHR1OAT02pgcj595Q'
  sheet_id = '678309503' #individual sheets have ids too
  range_name = 'B8:I540'
  with open('secrets.txt', 'r') as infile:
      API_KEY = infile.read()

  SCOPES = 'https://www.googleapis.com/auth/spreadsheets.readonly'
  API_URL = 'https://sheets.googleapis.com/v4/spreadsheets/{}'
  import requests
  params = {'key': API_KEY, 'ranges': range_name, 'fields': 'properties.title,sheets(data.rowData.values(effectiveValue))'}
  req = requests.get(API_URL.format(file_id), params=params)
  print(req.status_code)
  data = req.json()
  
#+END_SRC

#+RESULTS:
: 200

#+BEGIN_SRC ipython :session :results output
  #print(data['sheets'][0]['data'][0]['rowData'][0])
  row_data = data['sheets'][0]['data'][0]['rowData']
  row_data = list(map(lambda x: x['values'], row_data))

  card_list = list(filter(None, [card.get('effectiveValue').get('stringValue') if card.get('effectiveValue') else None for row in row_data for card in row]))
  print(card_list[:5])
  print(len(card_list))
#+END_SRC


#+RESULTS:
: ['Ajani, Caller of the Pride', 'Aetherling', 'Bile Blight', 'Abbot of Keral Keep', 'Acidic Slime']
: 506

#+BEGIN_SRC ipython :session :results output :exports both
  import re
  q_filter = re.compile('[?]')
  card_list = list(map(lambda x: q_filter.sub('', x), card_list))
  print(card_list[:5])
#+END_SRC

#+RESULTS:
: ['Ajani, Caller of the Pride', 'Aetherling', 'Bile Blight', 'Abbot of Keral Keep', 'Acidic Slime']


#+BEGIN_SRC ipython :session :results output :exports both
  cube_list = []

  def parse_color(colors, card_type):
      if 'Land' in card_type:
          return 'Land'
      elif colors == None:
          return 'Colorless'
      elif len(colors) == 1:
          return colors[0]
      elif len(colors) > 1:
          return 'Multicolored'
      else:
          return 'ERROR'

  for card_name in card_list:
      card_name = card_name.strip()
      if 'Aether' in card_name: #what idiot thought it would be funny to use weird UTF8 encoding on this
          card_name = card_name.replace('Aether', 'Æther')
      split_card = False
      if '/' in card_name: #what idiot thought it would be funny to split up split cards
          split_card = True
      if split_card:
          card_info = [cards[card_name.split('/')[0]], cards[card_name.split('/')[1]]]
      else:
          card_info = [cards[card_name]]
      for card_in in card_info:
          cube_list.append({'name': card_in['name'], 'cmc': card_in.get('cmc'), 'color': parse_color(card_in.get('colors'), card_in['type']), 'text': card_in.get('text')})
  cube_list = pd.DataFrame(cube_list)
  print(cube_list.head())
#+END_SRC

#+RESULTS:
#+begin_example
   cmc  color                        name  \
0  3.0  White  Ajani, Caller of the Pride   
1  6.0   Blue                   Ætherling   
2  2.0  Black                 Bile Blight   
3  2.0    Red         Abbot of Keral Keep   
4  5.0  Green                Acidic Slime   

                                                text  
0  +1: Put a +1/+1 counter on up to one target cr...  
1  {U}: Exile Ætherling. Return it to the battlef...  
2  Target creature and all other creatures with t...  
3  Prowess (Whenever you cast a noncreature spell...  
4  Deathtouch (Any amount of damage this deals to...  
#+end_example

#+BEGIN_SRC ipython :session :results output :exports both
  print(cube_list['color'].unique())
  print(cube_list[cube_list['color'] == 'Colorless'].head())
#+END_SRC

#+RESULTS:
#+begin_example
['White' 'Blue' 'Black' 'Red' 'Green' 'Multicolored' 'Land' 'Colorless']
     cmc      color                       name  \
7    1.0  Colorless           Adventuring Gear   
15   2.0  Colorless           Arcbound Ravager   
23   1.0  Colorless            Basilisk Collar   
31   5.0  Colorless                Batterskull   
39   3.0  Colorless           Cloudstone Curio   
47   8.0  Colorless       Eldrazi Conscription   
52   1.0  Colorless                 Blisterpod   
55   1.0  Colorless      Elixir of Immortality   
63   0.0  Colorless        Everflowing Chalice   
71   0.0  Colorless          Hangarback Walker   
79   NaN  Colorless                Lotus Bloom   
87   0.0  Colorless                    Memnite   
95   2.0  Colorless                 Mind Stone   
103  2.0  Colorless                  Mortarpod   
111  0.0  Colorless                   Mox Opal   
119  0.0  Colorless                Ornithopter   
127  1.0  Colorless             Pithing Needle   
133  3.0  Colorless            Catacomb Sifter   
135  2.0  Colorless            Prophetic Prism   
143  2.0  Colorless               Ratchet Bomb   
151  1.0  Colorless      Sensei's Divining Top   
159  1.0  Colorless                Signal Pest   
167  4.0  Colorless          Solemn Simulacrum   
175  2.0  Colorless         Sphere of the Suns   
183  3.0  Colorless     Sword of Body and Mind   
191  3.0  Colorless  Sword of Feast and Famine   
199  3.0  Colorless     Sword of War and Peace   
207  8.0  Colorless    Ugin, the Spirit Dragon   
215  6.0  Colorless            Wurmcoil Engine   
223  1.0  Colorless            Springleaf Drum   
232  4.0  Colorless                   Frogmite   
240  7.0  Colorless               Myr Enforcer   
248  2.0  Colorless              Myr Retriever   
263  1.0  Colorless        Relic of Progenitus   
271  2.0  Colorless         Runechanter's Pike   

                                                  text  
7    Landfall — Whenever a land enters the battlefi...  
15   Sacrifice an artifact: Put a +1/+1 counter on ...  
23   Equipped creature has deathtouch and lifelink....  
31   Living weapon (When this Equipment enters the ...  
39   Whenever a nonartifact permanent enters the ba...  
47   Enchant creature\nEnchanted creature gets +10/...  
52   Devoid (This card has no color.)\nWhen Blister...  
55   {2}, {T}: You gain 5 life. Shuffle Elixir of I...  
63   Multikicker {2} (You may pay an additional {2}...  
71   Hangarback Walker enters the battlefield with ...  
79   Suspend 3—{0} (Rather than cast this card from...  
87                                                None  
95   {T}: Add {C} to your mana pool.\n{1}, {T}, Sac...  
103  Living weapon (When this Equipment enters the ...  
111  Metalcraft — {T}: Add one mana of any color to...  
119  Flying (This creature can't be blocked except ...  
127  As Pithing Needle enters the battlefield, name...  
133  Devoid (This card has no color.)\nWhen Catacom...  
135  When Prophetic Prism enters the battlefield, d...  
143  {T}: Put a charge counter on Ratchet Bomb.\n{T...  
151  {1}: Look at the top three cards of your libra...  
159  Battle cry (Whenever this creature attacks, ea...  
167  When Solemn Simulacrum enters the battlefield,...  
175  Sphere of the Suns enters the battlefield tapp...  
183  Equipped creature gets +2/+2 and has protectio...  
191  Equipped creature gets +2/+2 and has protectio...  
199  Equipped creature gets +2/+2 and has protectio...  
207  +2: Ugin, the Spirit Dragon deals 3 damage to ...  
215  Deathtouch, lifelink\nWhen Wurmcoil Engine die...  
223  {T}, Tap an untapped creature you control: Add...  
232  Affinity for artifacts (This spell costs {1} l...  
240  Affinity for artifacts (This spell costs {1} l...  
248  When Myr Retriever dies, return another target...  
263  {T}: Target player exiles a card from his or h...  
271  Equipped creature has first strike and gets +X...  
#+end_example

